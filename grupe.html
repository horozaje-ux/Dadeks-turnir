<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <title>Dadeks turnir – Grupe i nokaut</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #020617;
      color: #e5e7eb;
    }

    a { color: inherit; text-decoration: none; }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }

    header {
      text-align: center;
      padding: 10px 0 18px;
    }

    header h1 {
      margin: 0;
      font-size: 1.8rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #38bdf8;
    }

    header p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 0.8rem;
      cursor: pointer;
      transition: 0.15s;
    }

    .back-link:hover { background: #0f172a; }

    .years {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 20px 0 12px;
    }

    .year-btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.8rem;
      cursor: pointer;
      transition: 0.15s;
    }

    .year-btn.active {
      background: #0ea5e9;
      color: #020617;
      font-weight: 600;
      border-color: transparent;
    }

    .section-title {
      margin-top: 12px;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #9ca3af;
    }

    .groups-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 16px;
      margin-top: 10px;
    }

    .card {
      background: radial-gradient(circle at top left, #0f172a, #020617 55%);
      border-radius: 16px;
      border: 1px solid #1f2937;
      padding: 14px;
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.75);
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .group-name {
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #bfdbfe;
    }

    .team-count {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.8);
      color: #9ca3af;
    }

    .team-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.82rem;
    }

    .team-list li {
      padding: 3px 0;
      border-bottom: 1px dashed #1f2937;
    }
    .team-list li:last-child { border-bottom: none; }

    .knockout-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
      margin-top: 10px;
    }

    .knockout-card h3 {
      margin: 0 0 6px;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      color: #facc15;
    }

    .fixture-list {
      list-style: none;
      padding: 0;
      margin: 0;
      font-size: 0.8rem;
    }

    .fixture-list li {
      padding: 10px 0;
      border-bottom: 1px solid #1f2937;
    }
    .fixture-list li:last-child { border-bottom: none; }

    .fixture-label {
      color: #9ca3af;
      font-size: 0.76rem;
      display: block;
      margin-bottom: 4px;
    }

    .fixture-teams {
      font-weight: 700;
      color: #e5e7eb;
      display: block;
      margin-bottom: 8px;
      line-height: 1.25;
    }

    .fixture-note {
      font-size: 0.75rem;
      color: #9ca3af;
      margin-top: 6px;
      display: block;
    }

    /* INPUTI ZA REZULTATE */
    .score-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .score-box {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      border: 1px solid #1f2937;
      border-radius: 12px;
      background: rgba(2,6,23,.55);
    }

    .score-box input {
      width: 56px;
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.85rem;
      outline: none;
    }

    .sep { color: #9ca3af; font-weight: 700; }

    .small-hint {
      font-size: 0.72rem;
      color: #9ca3af;
    }

    .winner-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(34,197,94,.12);
      color: #86efac;
      font-size: 0.75rem;
      width: fit-content;
    }

    .warn-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background: rgba(250,204,21,.12);
      color: #fde68a;
      font-size: 0.75rem;
      width: fit-content;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 10px;
    }

    .btn-clear {
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      padding: 8px 12px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: 0.15s;
    }
    .btn-clear:hover { background:#0f172a; }

    /* sponsor traka */
    .sponsor-strip {
      margin-top: 26px;
      padding: 10px 14px;
      border-radius: 999px;
      background: #facc15;
      color: #0f172a;
      font-size: 0.78rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    .sponsor-strip span.logo {
      font-weight: 800;
      padding: 3px 10px;
      border-radius: 999px;
      background: #0f172a;
      color: #facc15;
      margin-left: 6px;
    }

    @media (max-width: 640px) {
      .page { padding: 10px; }
      .score-box input { width: 52px; }
    }
  </style>
</head>

<body>
  <div class="page">
    <header>
      <h1>Dadeks turnir – Grupe i nokaut</h1>
      <p>Pregled grupa i završnice po godištima</p>
      <a href="index.html" class="back-link">← Nazad na Dadeks turnir 2025</a>
    </header>

    <div class="years">
      <button class="year-btn active" data-year="2015">2015</button>
      <button class="year-btn" data-year="2016">2016</button>
      <button class="year-btn" data-year="2017">2017</button>
      <button class="year-btn" data-year="2018">2018</button>
    </div>

    <p class="section-title" id="year-label">2015. godište</p>

    <!-- GRUPE -->
    <section>
      <h2 class="section-title">Grupe</h2>
      <div id="groups-container" class="groups-grid"></div>
    </section>

    <!-- NOKAUT FAZA -->
    <section style="margin-top:16px;">
      <h2 class="section-title">Nokaut faza</h2>
      <div id="knockout-container" class="knockout-grid"></div>
    </section>

    <!-- sponsor -->
    <div class="sponsor-strip">
      DADEKS TURNIR – GRUPE I NOKAUT · GENERALNI SPONZOR:
      <span class="logo">ŠANSABET.COM</span>
    </div>
  </div>

  <script>
    // =========================
    // PODACI: EKIPE PO GRUPAMA
    // =========================
    const GROUPS_DATA = {
      "2015": {
        "A": ["Dadeks", "Buducnost", "Akademik Nk", "Desetka Bar", "Fa Kerver 19"],
        "B": ["Pristina", "Fk Berane", "Župa Nk", "Bernabeu", "Danilovgrad 2"],
        "C": ["Herceg Novi", "Karioke Nk", "Danilovgrad 1", "Ilarion", "Podgorica"],
        "D": ["Fenix", "Otrant", "Barsa Bar", "Titan", "Porto"]
      },
      "2016": {
        "A": ["Dadeks", "Durmitor", "Centar", "As 1", "Akademik Nk"],
        "B": ["Herceg Novi", "Buducnost", "Danilovgrad", "Desetka"],
        "C": ["Otrant", "Fudbalito", "Porto", "Zupa", "Bernabeu"],
        "D": ["Onogost", "Barsa", "Stari aerodrom", "As 2", "Akademija Berane"]
      },
      "2017": {
        "A": ["Dadeks", "Karioke Nk", "Titan", "Bernabeu 1", "Tuzi"],
        "B": ["Stari Aerodrom", "Porto", "Fudbalito", "As", "Desetka"],
        "C": ["Nacional", "Berane", "Cijevna", "Danilovgrad", "Ilarion"],
        "D": ["Zlatna lopta", "Ibar", "Buducnost", "Bernabeu 2", "Centar"]
      },
      "2018": {
        "A": ["Dadeks", "Desetka", "Jezero", "Fudbalito 3"],
        "B": ["Zlatna lopta", "Fudbalito 2", "Arena", "Fenix"],
        "C": ["Bernabeu", "Fa Kerver", "Zupa", "Porto"],
        "D": ["Fudbalito 1", "Karioke Nk", "Akademija Berane", "Stari aerodrom"]
      }
    };

    let currentYear = "2015";
    let allMatches = [];

    // =========================
    // LOAD matches.json (za grupnu tabelu)
    // =========================
    async function loadMatches() {
      try {
        const resp = await fetch("matches.json?cache=" + Date.now());
        if (!resp.ok) throw new Error("HTTP " + resp.status);
        const data = await resp.json();
        allMatches = Array.isArray(data) ? data : [];
      } catch (err) {
        console.error("Greška pri učitavanju matches.json:", err);
        allMatches = [];
      }
    }

    // =========================
    // STANDINGS IZ matches.json
    // =========================
    function calculateStandings(year) {
      const groups = GROUPS_DATA[year];
      if (!groups) return {};

      const standings = {};
      Object.entries(groups).forEach(([grp, teams]) => {
        standings[grp] = teams.map(name => ({
          team: name,
          gp: 0, w: 0, d: 0, l: 0,
          gf: 0, ga: 0, gd: 0, pts: 0
        }));
      });

      const matches = allMatches.filter(m => m.godiste === year);
      matches.forEach(m => {
        const grp = m.grupa;
        const table = standings[grp];
        if (!table) return;

        const home = table.find(t => t.team === m.domacin);
        const away = table.find(t => t.team === m.gost);
        if (!home || !away) return;

        const gh = Number(m.golDom);
        const ga = Number(m.golGost);
        if (Number.isNaN(gh) || Number.isNaN(ga)) return;

        home.gp++; away.gp++;
        home.gf += gh; home.ga += ga;
        away.gf += ga; away.ga += gh;
        home.gd = home.gf - home.ga;
        away.gd = away.gf - away.ga;

        if (gh > ga) {
          home.w++; home.pts += 3; away.l++;
        } else if (gh < ga) {
          away.w++; away.pts += 3; home.l++;
        } else {
          home.d++; away.d++;
          home.pts++; away.pts++;
        }
      });

      Object.keys(standings).forEach(grp => {
        standings[grp].sort((a, b) =>
          b.pts - a.pts ||
          b.gd - a.gd ||
          b.gf - a.gf ||
          a.team.localeCompare(b.team, "sr")
        );
      });

      return standings;
    }

    // =========================
    // RENDER GRUPA
    // =========================
    function renderGroups(year) {
      const container = document.getElementById("groups-container");
      const groups = GROUPS_DATA[year];
      if (!groups) {
        container.innerHTML = "<p>Nema podataka za ovo godište.</p>";
        return;
      }

      let html = "";
      Object.entries(groups).forEach(([grp, teams]) => {
        const labelTeams = teams.length + " ekipa";
        html += `
          <div class="card">
            <div class="group-header">
              <span class="group-name">Grupa ${grp}</span>
              <span class="team-count">${labelTeams}</span>
            </div>
            <ul class="team-list">
              ${teams.map(t => `<li>${t}</li>`).join("")}
            </ul>
          </div>`;
      });

      container.innerHTML = html;
    }

    // =========================
    // LOCAL STORAGE – NOKAUT REZULTATI (po godištu)
    // =========================
    const LS_KEY = "dadeks_bracket_v1";

    function loadBracketStore() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        const obj = raw ? JSON.parse(raw) : {};
        return (obj && typeof obj === "object") ? obj : {};
      } catch {
        return {};
      }
    }

    function saveBracketStore(store) {
      try {
        localStorage.setItem(LS_KEY, JSON.stringify(store));
      } catch {}
    }

    function getYearBracket(year) {
      const store = loadBracketStore();
      if (!store[year]) store[year] = {};
      return store[year];
    }

    function setMatchScore(year, matchKey, data) {
      const store = loadBracketStore();
      if (!store[year]) store[year] = {};
      store[year][matchKey] = { ...(store[year][matchKey] || {}), ...data };
      saveBracketStore(store);
    }

    function clearYearBracket(year) {
      const store = loadBracketStore();
      delete store[year];
      saveBracketStore(store);
    }

    // =========================
    // HELPERI – winner/loser
    // =========================
    function toNum(v) {
      if (v === "" || v === null || v === undefined) return null;
      const n = Number(v);
      return Number.isFinite(n) ? n : null;
    }

    // odlučuje pobjednika: prvo golovi, pa penali ako je neriješeno
    function decideWinner(home, away, gh, ga, ph, pa) {
      if (gh === null || ga === null) return { winner: null, loser: null, note: "Upiši rezultat." };

      if (gh > ga) return { winner: home, loser: away, note: "Pobjednik: " + home };
      if (ga > gh) return { winner: away, loser: home, note: "Pobjednik: " + away };

      // neriješeno → penali
      if (ph === null || pa === null) return { winner: null, loser: null, note: "Neriješeno – upiši penale." };
      if (ph > pa) return { winner: home, loser: away, note: "Pobjednik (pen): " + home };
      if (pa > ph) return { winner: away, loser: home, note: "Pobjednik (pen): " + away };

      return { winner: null, loser: null, note: "Penali isti – provjeri." };
    }

    // uzmi tim sa pozicije iz grupe (ako nema utakmica – uzmi redosled iz GROUPS_DATA)
    function teamFromGroup(year, standings, groupLetter, pos) {
      const table = standings[groupLetter] || [];

      if (table.length && table.every(t => t.gp === 0)) {
        const list = (GROUPS_DATA[year] && GROUPS_DATA[year][groupLetter]) || [];
        return list[pos - 1] || `Pozicija ${pos} u grupi ${groupLetter}`;
      }

      return table[pos - 1]?.team || `Pozicija ${pos} u grupi ${groupLetter}`;
    }

    // =========================
    // RENDER NOKAUT – sa inputima + auto SF/Finale
    // =========================
    function renderKnockout(year) {
      const container = document.getElementById("knockout-container");
      const standings = calculateStandings(year);
      const bracket = getYearBracket(year);

      // QF timovi (iz grupa)
      const A1 = teamFromGroup(year, standings, "A", 1);
      const A2 = teamFromGroup(year, standings, "A", 2);
      const B1 = teamFromGroup(year, standings, "B", 1);
      const B2 = teamFromGroup(year, standings, "B", 2);
      const C1 = teamFromGroup(year, standings, "C", 1);
      const C2 = teamFromGroup(year, standings, "C", 2);
      const D1 = teamFromGroup(year, standings, "D", 1);
      const D2 = teamFromGroup(year, standings, "D", 2);

      const qf = {
        qf1: { label: "A1 – C2", home: A1, away: C2, note: "Prvi iz grupe A vs drugi iz grupe C" },
        qf2: { label: "A2 – C1", home: A2, away: C1, note: "Drugi iz grupe A vs prvi iz grupe C" },
        qf3: { label: "B1 – D2", home: B1, away: D2, note: "Prvi iz grupe B vs drugi iz grupe D" },
        qf4: { label: "B2 – D1", home: B2, away: D1, note: "Drugi iz grupe B vs prvi iz grupe D" },
      };

      // pročitaj rezultate QF iz storage
      function getScore(key) {
        const d = bracket[key] || {};
        return {
          gh: toNum(d.gh),
          ga: toNum(d.ga),
          ph: toNum(d.ph),
          pa: toNum(d.pa),
        };
      }

      const qfRes = {};
      Object.keys(qf).forEach(k => {
        const s = getScore(k);
        qfRes[k] = decideWinner(qf[k].home, qf[k].away, s.gh, s.ga, s.ph, s.pa);
      });

      // SF parovi (pobjednici QF1 vs QF3, QF2 vs QF4)
      const sf1_home = qfRes.qf1.winner || "Pobjednik " + qf.qf1.label;
      const sf1_away = qfRes.qf3.winner || "Pobjednik " + qf.qf3.label;
      const sf2_home = qfRes.qf2.winner || "Pobjednik " + qf.qf2.label;
      const sf2_away = qfRes.qf4.winner || "Pobjednik " + qf.qf4.label;

      const sf = {
        sf1: { label: "P1", home: sf1_home, away: sf1_away, note: "Pobjednici 1. i 3. četvrtfinala" },
        sf2: { label: "P2", home: sf2_home, away: sf2_away, note: "Pobjednici 2. i 4. četvrtfinala" },
      };

      const sfRes = {};
      Object.keys(sf).forEach(k => {
        const s = getScore(k);
        sfRes[k] = decideWinner(sf[k].home, sf[k].away, s.gh, s.ga, s.ph, s.pa);
      });

      // Finale + 3. mjesto
      const f_home = sfRes.sf1.winner || "Pobjednik P1";
      const f_away = sfRes.sf2.winner || "Pobjednik P2";
      const t3_home = sfRes.sf1.loser || "Poraženi P1";
      const t3_away = sfRes.sf2.loser || "Poraženi P2";

      // HTML generator za jednu utakmicu sa inputima
      function matchLi(key, label, home, away, note) {
        const s = getScore(key);
        const res = decideWinner(home, away, s.gh, s.ga, s.ph, s.pa);

        const winChip = res.winner
          ? `<div class="winner-chip">✅ ${res.note}</div>`
          : `<div class="warn-chip">⚠️ ${res.note}</div>`;

        return `
          <li>
            <span class="fixture-label">${label}</span>
            <span class="fixture-teams">${home} – ${away}</span>

            <div class="score-row">
              <div class="score-box" title="Golovi">
                <input inputmode="numeric" type="number" min="0" id="${key}-gh" placeholder="0" value="${s.gh ?? ""}">
                <span class="sep">:</span>
                <input inputmode="numeric" type="number" min="0" id="${key}-ga" placeholder="0" value="${s.ga ?? ""}">
              </div>

              <div class="score-box" title="Penali (samo ako je neriješeno)">
                <span class="small-hint">Pen.</span>
                <input inputmode="numeric" type="number" min="0" id="${key}-ph" placeholder="-" value="${s.ph ?? ""}">
                <span class="sep">:</span>
                <input inputmode="numeric" type="number" min="0" id="${key}-pa" placeholder="-" value="${s.pa ?? ""}">
              </div>
            </div>

            ${winChip}
            <span class="fixture-note">${note || ""}</span>
          </li>
        `;
      }

      container.innerHTML = `
        <div class="card knockout-card">
          <h3>Četvrtfinale</h3>
          <ul class="fixture-list">
            ${matchLi("qf1", qf.qf1.label, qf.qf1.home, qf.qf1.away, qf.qf1.note)}
            ${matchLi("qf2", qf.qf2.label, qf.qf2.home, qf.qf2.away, qf.qf2.note)}
            ${matchLi("qf3", qf.qf3.label, qf.qf3.home, qf.qf3.away, qf.qf3.note)}
            ${matchLi("qf4", qf.qf4.label, qf.qf4.home, qf.qf4.away, qf.qf4.note)}
          </ul>

          <div class="btn-row">
            <button class="btn-clear" id="clear-bracket">Obriši nokaut rezultate (ovo godište)</button>
          </div>
        </div>

        <div class="card knockout-card">
          <h3>Polufinale</h3>
          <ul class="fixture-list">
            ${matchLi("sf1", "P1: (QF1) – (QF3)", sf.sf1.home, sf.sf1.away, sf.sf1.note)}
            ${matchLi("sf2", "P2: (QF2) – (QF4)", sf.sf2.home, sf.sf2.away, sf.sf2.note)}
          </ul>
        </div>

        <div class="card knockout-card">
          <h3>Finale</h3>
          <ul class="fixture-list">
            <li>
              <span class="fixture-label">Finale: P1 – P2</span>
              <span class="fixture-teams">${f_home} – ${f_away}</span>
              <span class="fixture-note">Automatski se popunjava iz polufinala</span>
            </li>
          </ul>

          <h3 style="margin-top:12px;">Utakmica za 3. mjesto</h3>
          <ul class="fixture-list">
            <li>
              <span class="fixture-label">3. mjesto: (poraženi P1) – (poraženi P2)</span>
              <span class="fixture-teams">${t3_home} – ${t3_away}</span>
              <span class="fixture-note">Automatski se popunjava iz polufinala</span>
            </li>
          </ul>
        </div>
      `;

      // Bind input events → snimi u localStorage → rerender knockout
      function bindMatchInputs(keys) {
        keys.forEach(key => {
          ["gh","ga","ph","pa"].forEach(field => {
            const id = `${key}-${field}`;
            const el = document.getElementById(id);
            if (!el) return;

            el.addEventListener("input", () => {
              setMatchScore(year, key, {
                [field]: el.value
              });
              renderKnockout(year);
            });
          });
        });
      }

      bindMatchInputs(["qf1","qf2","qf3","qf4","sf1","sf2"]);

      // Clear button
      const clearBtn = document.getElementById("clear-bracket");
      if (clearBtn) {
        clearBtn.addEventListener("click", () => {
          clearYearBracket(year);
          renderKnockout(year);
        });
      }
    }

    // =========================
    // PROMJENA GODIŠTA
    // =========================
    function setYear(year) {
      currentYear = year;
      document.getElementById("year-label").textContent = year + ". godište";

      document.querySelectorAll(".year-btn").forEach(btn => {
        btn.classList.toggle("active", btn.dataset.year === year);
      });

      renderGroups(year);
      renderKnockout(year);
    }

    // =========================
    // INIT
    // =========================
    document.addEventListener("DOMContentLoaded", async () => {
      document.querySelectorAll(".year-btn").forEach(btn => {
        btn.addEventListener("click", () => setYear(btn.dataset.year));
      });

      await loadMatches();
      setYear("2015");
    });
  </script>
</body>
</html>
