<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="UTF-8" />
  <title>Dadeks turnir</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --bg-dark: #020617;
      --bg-card: #020617;
      --primary: #1d4ed8;
      --primary-soft: rgba(37, 99, 235, 0.6);
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --pill-bg: #020617;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1d4ed8, #020617);
      color: var(--text-main);
    }

    .app {
      max-width: 1000px;
      margin: 0 auto;
      padding: 16px 12px 32px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      animation: slideDown 0.6s ease-out;
    }

    header img.logo {
      width: 70px;
      height: 70px;
      border-radius: 18px;
      background: #020617;
      padding: 4px;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.6),
                  0 10px 25px rgba(15, 23, 42, 0.8);
      object-fit: contain;
    }

    header h1 {
      margin: 0 0 4px;
      font-size: 24px;
    }

    header p.sub {
      margin: 0;
      opacity: 0.85;
      font-size: 14px;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: var(--pill-bg);
      font-size: 12px;
      border: 1px solid var(--primary);
      white-space: nowrap;
    }

    /* TABOVI */
    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin: 18px 0 12px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      padding-bottom: 6px;
    }

    .tab-btn {
      border: none;
      background: transparent;
      color: #e5e7eb;
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .tab-btn:hover {
      background: rgba(37, 99, 235, 0.25);
      transform: translateY(-1px);
    }

    .tab-btn.active {
      background: var(--primary);
      color: var(--text-main);
      box-shadow: 0 0 0 1px rgba(191, 219, 254, 0.3);
    }

    .tab-content {
      display: none;
      animation: fadeIn 0.25s ease-out;
    }

    .tab-content.active {
      display: block;
    }

    /* KARTICE */
    .card {
      background: var(--bg-card);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
      border: 1px solid var(--primary-soft);
    }

    .card h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 18px;
    }

    .hint {
      font-size: 13px;
      color: #cbd5f5;
      margin-bottom: 8px;
    }

    .helper-text {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 10px;
    }

    .iframe-wrapper {
      position: relative;
      width: 100%;
      height: 430px;
      border-radius: 12px;
      overflow: hidden;
      background: #020617;
      margin-top: 4px;
    }

    .iframe-wrapper iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    /* LIVE SCORE LAYOUT */
    .live-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr);
      gap: 12px;
    }

    .live-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .live-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
    }

    .match-list {
      max-height: 240px;
      overflow: auto;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 6px;
      background: rgba(15, 23, 42, 0.9);
    }

    .match-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 4px 4px;
      border-radius: 6px;
    }

    .match-item:nth-child(2n) {
      background: rgba(15, 23, 42, 0.7);
    }

    .match-item label {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      width: 100%;
      justify-content: space-between;
    }

    .match-name {
      flex: 1;
      min-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .match-score {
      font-weight: 600;
      font-variant-numeric: tabular-nums;
    }

    .match-status {
      font-size: 10px;
      color: var(--text-muted);
      margin-left: 6px;
      white-space: nowrap;
    }

    .toggle-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 11px;
      color: var(--text-muted);
    }

    input[type="checkbox"] {
      width: 14px;
      height: 14px;
      cursor: pointer;
    }

    /* SUB TABOVI ZA QF/SF/F */
    .sub-tabs {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }

    .sub-tab-btn {
      border: none;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      border: 1px solid rgba(148, 163, 184, 0.7);
    }

    .sub-tab-btn.active {
      background: var(--primary);
      border-color: var(--primary-soft);
    }

    .sub-tab-pane {
      display: none;
    }

    .sub-tab-pane.active {
      display: block;
    }

    /* SELECT GODI≈†TE */
    .gen-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    select {
      background: #020617;
      color: #e5e7eb;
      border-radius: 999px;
      border: 1px solid #1d4ed8;
      padding: 6px 12px;
      font-size: 13px;
    }

    /* RESPONSIVE */
    @media (max-width: 600px) {
      header {
        flex-direction: row;
        align-items: center;
      }

      .app {
        padding: 12px 10px 24px;
      }

      .iframe-wrapper {
        height: 360px;
      }

      .live-layout {
        grid-template-columns: minmax(0, 1fr);
      }

      .match-list {
        max-height: 210px;
      }
    }

    @keyframes slideDown {
      from {
        transform: translateY(-12px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(4px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <img src="logo.png" alt="Dadeks turnir logo" class="logo" />
    <div>
      <h1>Dadeks Turnir</h1>
      <p class="sub">Tradicionalni turnir povodom Dana osloboƒëenja Podgorice</p>
      <div class="pill-row">
        <span class="pill">üìÖ 19‚Äì21. decembar</span>
        <span class="pill">üìç Podgorica</span>
        <span class="pill">üìû 069 313 817</span>
      </div>
    </div>
  </header>

  <!-- NAV TABOVI -->
  <nav class="tabs">
    <button class="tab-btn active" onclick="openTab('info', this)">Info</button>
    <button class="tab-btn" onclick="openTab('live', this)">Live score</button>
    <button class="tab-btn" onclick="openTab('raspored', this)">Raspored</button>
    <button class="tab-btn" onclick="openTab('rezultati', this)">Rezultati</button>
    <button class="tab-btn" onclick="openTab('tabele', this)">Playoff (QF/SF/F)</button>
    <button class="tab-btn" onclick="openTab('timovi', this)">Timovi</button>
    <button class="tab-btn" onclick="openTab('lokacije', this)">Lokacije</button>
    <button class="tab-btn" onclick="openTab('kontakt', this)">Kontakt</button>
  </nav>

  <!-- INFO -->
  <section class="tab-content active" id="info">
    <div class="card">
      <h2>Osnovne informacije</h2>
      <p>
        Dobrodo≈°li na <strong>Dadeks turnir</strong> povodom Dana osloboƒëenja Podgorice.
        Na jednom mjestu okupljamo najtalentovanije ekipe mlaƒëih kategorija ‚Äì 2015, 2016, 2017, 2018 godi≈°te.
      </p>
      <p class="helper-text">
        Koristi tabove iznad za raspored, live score, rezultate, tabele i timove po godi≈°tima.
      </p>
    </div>
  </section>

  <!-- LIVE SCORE TAB -->
  <section class="tab-content" id="live">
    <div class="card">
      <h2>Live score</h2>
      <p class="hint">
        Rezultati se povlaƒçe direktno iz Google Sheets. Stranica se sama osvje≈æava, a mo≈æe≈° i da oznaƒçi≈° utakmice koje ≈æeli≈° da prati≈° ‚Äì telefon ƒáe pustiti zvuk kad se promijeni rezultat.
      </p>

      <div class="live-layout">
        <!-- lijevo: izbor utakmica -->
        <div class="live-controls">
          <div class="live-row">
            <span class="badge">‚öΩ Izaberi meƒçeve za praƒáenje</span>
            <span class="badge" id="live-status-badge">‚è±Ô∏è osvje≈æavanje...</span>
          </div>

          <div class="toggle-row">
            <label>
              <input type="checkbox" id="sound-enabled" checked />
              Ukljuƒçi zvuk kod promjene rezultata
            </label>
            <span>‚Ä¢</span>
            <span>Osvje≈æavanje ~10s</span>
          </div>

          <div id="match-list" class="match-list">
            <div class="hint" style="padding: 6px 4px;">
              ƒåekiraj utakmice koje ≈æeli≈° da prati≈°. Lista se puni automatski iz Live Score tabele.
            </div>
          </div>

          <p class="helper-text">
            Ako ne vidi≈° sve utakmice, provjeri da je Google Sheets live tabela objavljena i da ima kolonu
            ‚ÄûUtakmica‚Äú, ‚ÄûMeƒç‚Äú, ili timove i ‚ÄûRezultat‚Äú.
          </p>
        </div>

        <!-- desno: originalni live score sheet -->
        <div>
          <div class="iframe-wrapper">
            <iframe
              id="live-iframe"
              src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=1224715353&single=true&widget=true&headers=false">
            </iframe>
          </div>
          <p class="helper-text">
            Live score ureƒëuje≈° u listu ‚ÄûLive score‚Äú u Google Sheets dokumentu. Svaka promjena se vidi ovdje.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- RASPORED -->
  <section class="tab-content" id="raspored">
    <div class="card">
      <h2>Raspored utakmica</h2>
      <div class="iframe-wrapper">
        <iframe
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=0&single=true&widget=true&headers=false">
        </iframe>
      </div>
      <p class="helper-text">
        Raspored ureƒëuje≈° u Google Sheets dokumentu (list ‚ÄûRaspored‚Äú). Svaka promjena se odmah vidi ovde.
      </p>
    </div>
  </section>

  <!-- REZULTATI -->
  <section class="tab-content" id="rezultati">
    <div class="card">
      <h2>Rezultati</h2>
      <div class="iframe-wrapper">
        <iframe
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=2133224638&single=true&widget=true&headers=false">
        </iframe>
      </div>
      <p class="helper-text">
        Rezultate unosi≈° u Google Sheets (list ‚ÄûRezultati‚Äú).
      </p>
    </div>
  </section>

  <!-- PLAYOFF: QF / SF / F -->
  <section class="tab-content" id="tabele">
    <div class="card">
      <h2>Playoff tabele ‚Äì sva godi≈°ta</h2>
      <p class="hint">
        Posebne tabele za ƒçetvrtfinale, polufinale i finale. U svakom listu mo≈æe≈° imati sve generacije (2015‚Äì2018).
      </p>

      <div class="sub-tabs">
        <button class="sub-tab-btn active" onclick="openSubTab('qf', this)">QF ‚Äì ƒåetvrtfinale</button>
        <button class="sub-tab-btn" onclick="openSubTab('sf', this)">SF ‚Äì Polufinale</button>
        <button class="sub-tab-btn" onclick="openSubTab('f', this)">F ‚Äì Finale</button>
      </div>

      <div class="sub-tab-pane active" id="qf">
        <div class="iframe-wrapper">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=864058856&single=true&widget=true&headers=false">
          </iframe>
        </div>
      </div>

      <div class="sub-tab-pane" id="sf">
        <div class="iframe-wrapper">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=1643104694&single=true&widget=true&headers=false">
          </iframe>
        </div>
      </div>

      <div class="sub-tab-pane" id="f">
        <div class="iframe-wrapper">
          <iframe
            src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=533875103&single=true&widget=true&headers=false">
          </iframe>
        </div>
      </div>

      <p class="helper-text">
        U Google Sheets vodi≈° posebne listove za QF, SF i F. Ovdje su samo uvezene tabele.
      </p>
    </div>
  </section>

  <!-- TIMOVI ‚Äì GODI≈†TA -->
  <section class="tab-content" id="timovi">
    <div class="card">
      <h2>Timovi po godi≈°tima</h2>

      <div class="gen-row">
        <p class="hint" id="selected-gen-text">Odabrano godi≈°te: <strong>2015</strong></p>

        <label class="hint">
          Izaberi godi≈°te:
          <select id="gen-select" onchange="changeGeneration(this.value)">
            <option value="2015" selected>2015</option>
            <option value="2016">2016</option>
            <option value="2017">2017</option>
            <option value="2018">2018</option>
          </select>
        </label>
      </div>

      <div class="iframe-wrapper">
        <iframe
          id="teams-iframe"
          src="https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=988009385&single=true&widget=true&headers=false">
        </iframe>
      </div>

      <p class="helper-text">
        Timove dodaje≈° u Google Sheets (listovi ‚ÄûGodiste 2015‚Äú, ‚ÄûGodiste 2016‚Äú, ‚ÄûGodiste 2017‚Äú, ‚ÄûGodiste 2018‚Äú).
        Svaka promjena se automatski vidi u aplikaciji.
      </p>
    </div>
  </section>

  <!-- LOKACIJE -->
  <section class="tab-content" id="lokacije">
    <div class="card">
      <h2>Lokacije turnira</h2>
      <p>
        Ovde mo≈æe≈° kasnije dodati mapu ili opis terena (Dadeks, FSCG, Kamp, Tuzi, itd.)
        ‚Äì trenutno je placeholder.
      </p>
    </div>
  </section>

  <!-- KONTAKT -->
  <section class="tab-content" id="kontakt">
    <div class="card">
      <h2>Kontakt</h2>
      <p>
        Za sve informacije o turniru: <br />
        üìû 069 313 817 <br />
        üìß horozaje@hotmail.com
      </p>
    </div>
  </section>
</div>

<script>
  // --------- TABOVI (GLAVNI) ----------
  function openTab(tabId, btn) {
    document.querySelectorAll('.tab-content').forEach(function (el) {
      el.classList.remove('active');
    });
    document.getElementById(tabId).classList.add('active');

    document.querySelectorAll('.tab-btn').forEach(function (b) {
      b.classList.remove('active');
    });
    btn.classList.add('active');
  }

  // --------- SUB TABOVI QF/SF/F ----------
  function openSubTab(id, btn) {
    document.querySelectorAll('.sub-tab-pane').forEach(function (p) {
      p.classList.remove('active');
    });
    document.getElementById(id).classList.add('active');

    document.querySelectorAll('.sub-tab-btn').forEach(function (b) {
      b.classList.remove('active');
    });
    btn.classList.add('active');
  }

  // --------- TIMOVI ‚Äì GODI≈†TA ----------
  const GEN_URLS = {
    "2015": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=988009385&single=true&widget=true&headers=false",
    "2016": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=663500479&single=true&widget=true&headers=false",
    "2017": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=954938894&single=true&widget=true&headers=false",
    "2018": "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=419575061&single=true&widget=true&headers=false"
  };

  function changeGeneration(gen) {
    var txt = document.getElementById('selected-gen-text');
    txt.innerHTML = 'Odabrano godi≈°te: <strong>' + gen + '</strong>';

    var iframe = document.getElementById('teams-iframe');
    iframe.src = GEN_URLS[gen];
  }

  // --------- LIVE SCORE ‚Äì AUTO REFRESH + ZVUK + PRAƒÜENJE MEƒåEVA ----------
  const LIVE_IFRAME_BASE =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pubhtml?gid=1224715353&single=true&widget=true&headers=false";

  const LIVE_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQnO8M50g_PHsE59zwQvGuhAywll0EBlj0pM65Z_XZ60WRgS0mEDKoF7t_QPFix2m3mEkSX1YwTptO6/pub?gid=1224715353&single=true&output=csv";

  const matchListEl = document.getElementById('match-list');
  const statusBadge = document.getElementById('live-status-badge');
  const soundEnabledEl = document.getElementById('sound-enabled');
  const liveIframe = document.getElementById('live-iframe');

  let lastScores = {};      // { matchId: "1:0" }
  let watchedMatches = {};  // { matchId: true }
  let firstLoad = true;

  // jednostavan parser CSV-a (dovoljno za na≈°e potrebe)
  function parseCSV(text) {
    const rows = text.split(/\r?\n/).filter(r => r.trim().length > 0);
    return rows.map(row => {
      const out = [];
      let cur = '';
      let insideQuotes = false;
      for (let i = 0; i < row.length; i++) {
        const ch = row[i];
        if (ch === '"') {
          if (insideQuotes && row[i + 1] === '"') {
            // escaped "
            cur += '"';
            i++;
          } else {
            insideQuotes = !insideQuotes;
          }
        } else if (ch === ',' && !insideQuotes) {
          out.push(cur);
          cur = '';
        } else {
          cur += ch;
        }
      }
      out.push(cur);
      return out;
    });
  }

  function findColumn(headers, candidates) {
    const lower = headers.map(h => h.toLowerCase());
    for (let i = 0; i < lower.length; i++) {
      for (const c of candidates) {
        if (lower[i].includes(c)) return i;
      }
    }
    return -1;
  }

  function renderMatches(rows, headers) {
    const matchCol = findColumn(headers, ["utak", "meƒç", "mec", "match"]);
    const homeCol  = findColumn(headers, ["dom", "home"]);
    const awayCol  = findColumn(headers, ["gos", "away"]);
    const scoreCol = findColumn(headers, ["rez", "gol", "score"]);

    const statusCol = findColumn(headers, ["status", "minute", "min"]);

    const newLastScores = {};
    const matches = [];

    for (let i = 1; i < rows.length; i++) {
      const r = rows[i];
      if (!r || r.length === 0) continue;

      const rawMatch = matchCol >= 0 ? (r[matchCol] || "").trim() : "";
      const home = homeCol >= 0 ? (r[homeCol] || "").trim() : "";
      const away = awayCol >= 0 ? (r[awayCol] || "").trim() : "";
      const score = scoreCol >= 0 ? (r[scoreCol] || "").trim() : "";
      const status = statusCol >= 0 ? (r[statusCol] || "").trim() : "";

      if (!rawMatch && !home && !away && !score) continue;

      const id = rawMatch || (home + " - " + away) || ("Utakmica " + i);
      const label =
        rawMatch ||
        (home && away ? (home + " - " + away) : ("Utakmica " + i));

      newLastScores[id] = score;

      matches.push({
        id,
        label,
        score,
        status
      });
    }

    // Detekcija promjene rezultata
    if (!firstLoad) {
      matches.forEach(m => {
        const oldScore = lastScores[m.id];
        if (oldScore != null && oldScore !== m.score && m.score && watchedMatches[m.id]) {
          playBeep();
        }
      });
    }

    lastScores = newLastScores;

    // Render liste
    const prevWatched = { ...watchedMatches };

    matchListEl.innerHTML = "";
    if (matches.length === 0) {
      const div = document.createElement("div");
      div.className = "hint";
      div.style.padding = "6px 4px";
      div.textContent =
        "Nisu pronaƒëene utakmice u Live Score tabeli. Provjeri da tabela ima nazive kolona (Utakmica / Domacin / Gost / Rezultat).";
      matchListEl.appendChild(div);
      return;
    }

    matches.forEach(m => {
      if (prevWatched[m.id]) {
        watchedMatches[m.id] = true;
      }

      const row = document.createElement("div");
      row.className = "match-item";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = !!watchedMatches[m.id];
      checkbox.addEventListener("change", () => {
        watchedMatches[m.id] = checkbox.checked;
      });

      const label = document.createElement("label");
      const nameSpan = document.createElement("span");
      nameSpan.className = "match-name";
      nameSpan.textContent = m.label;

      const rightSpan = document.createElement("span");
      const scoreSpan = document.createElement("span");
      scoreSpan.className = "match-score";
      scoreSpan.textContent = m.score || "-";

      const statusSpan = document.createElement("span");
      statusSpan.className = "match-status";
      statusSpan.textContent = m.status || "";

      rightSpan.appendChild(scoreSpan);
      if (m.status) rightSpan.appendChild(statusSpan);

      label.appendChild(nameSpan);
      label.appendChild(rightSpan);

      row.appendChild(checkbox);
      row.appendChild(label);

      matchListEl.appendChild(row);
    });

    firstLoad = false;
  }

  function playBeep() {
    if (!soundEnabledEl.checked) return;
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = "triangle";
      osc.frequency.value = 880; // visok ton
      osc.connect(gain);
      gain.connect(ctx.destination);
      gain.gain.setValueAtTime(0.15, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.8);
      osc.start();
      osc.stop(ctx.currentTime + 0.8);
    } catch (e) {
      // ako ne mo≈æe audio, samo ignori≈°i
    }
  }

  async function refreshLive() {
    statusBadge.textContent = "‚è±Ô∏è osvje≈æavanje...";
    try {
      const res = await fetch(LIVE_CSV_URL, { cache: "no-store" });
      const text = await res.text();
      const rows = parseCSV(text);
      if (rows.length === 0) {
        statusBadge.textContent = "‚ö†Ô∏è nema podataka";
        return;
      }
      renderMatches(rows, rows[0]);
      statusBadge.textContent = "‚úÖ a≈æurirano";
    } catch (e) {
      statusBadge.textContent = "‚ö†Ô∏è problem sa live podacima";
    }
  }

  // Periodiƒçni refresh CSV-a
  refreshLive();
  setInterval(refreshLive, 10000); // 10 sekundi

  // Povremeno osvje≈æi i sam iframe (vizuelni dio)
  setInterval(() => {
    liveIframe.src = LIVE_IFRAME_BASE + "&t=" + Date.now();
  }, 15000); // 15 sekundi
</script>
</body>
</html>
